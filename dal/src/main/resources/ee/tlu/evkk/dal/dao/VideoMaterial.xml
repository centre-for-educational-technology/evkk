<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ee.tlu.evkk.dal.dao.VideoMaterialDao">
  <sql id="videoMaterialColumns">
    mtype.id = vm_id,
    mtype.video_url = vm_video_url,
    mtype.platform = vm_platform,
    mtype.embed_code = vm_embed_code,
    mtype.material_id = vm_material_id
  </sql>

  <resultMap id="VideoMaterialResultMap" type="ee.tlu.evkk.dal.dto.FileMaterial">
    <id property="id" column="vm_id"/>
    <result property="videoUrl" column="vm_video_url"/>
    <result property="platform" column="vm_platform"/>
    <result property="embedCode" column="vm_embed_code"/>
    <result property="materialId" column="vm_material_id"/>
    <association property="material" resultMap="ee.tlu.evkk.dal.dao.MaterialDao.MaterialResultMap"/>
  </resultMap>

  <select id="findAllVideoMaterials" resultMap="FileMaterialResultMap">
    SELECT
    <include refid="ee.tlu.evkk.dal.dao.VideoMaterialDao.videoMaterialColumns"/>,
    <include refid="ee.tlu.evkk.dal.dao.MaterialDao.materialAssociationColumns"/>
    FROM core.video_material mtype
    <include refid="ee.tlu.evkk.dal.dao.MaterialTypeDao.materialJoin"/>
    <include refid="ee.tlu.evkk.dal.dao.MaterialDao.materialAssociations"/>
  </select>

  <select id="findById" parameterType="string" resultMap="VideoMaterialResultMap">
    SELECT
    <include refid="ee.tlu.evkk.dal.dao.VideoMaterialDao.videoMaterialColumns"/>,
    <include refid="ee.tlu.evkk.dal.dao.MaterialDao.materialAssociationColumns"/>
    FROM core.video_material mtype
    <include refid="ee.tlu.evkk.dal.dao.MaterialTypeDao.materialJoin"/>
    <include refid="ee.tlu.evkk.dal.dao.MaterialDao.materialAssociations"/>
    WHERE vm.id = #{id}
  </select>

  <insert id="insertVideoMaterial" parameterType="ee.tlu.evkk.dal.dto.TextMaterial" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO core.video_material (
      video_url,
      platform,
      embed_code,
      material_id
    ) VALUES (
      #{videoUrl},
      #{platform},
      #{embedCode},
      #{materialId}
    )
  </insert>

</mapper>
